<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fees Payment & Alumni</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      /* Button Blink Animation */
      @keyframes purpleBlink {
        0% {
          background-color: #6b21a8;
        }
        50% {
          background-color: #9333ea;
        }
        100% {
          background-color: #6b21a8;
        }
      }

      /* Bounce Animation */
      @keyframes bounceRepeat {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-6px);
        }
      }
    </style>
  </head>

  <body class="bg-gray-100">
    <!-- HEADER -->
    <header
      class="bg-[#523A35] border-b-4 border-[#D4A017] flex flex-col items-center px-4 sm:px-6 py-4 shadow-md"
    >
      <!-- LOGO + TITLE -->
      <div
        class="flex flex-col sm:flex-row justify-center items-center space-y-3 sm:space-y-0 sm:space-x-4"
      >
        <!-- LOGO -->
        <img
          src="academiclogo.png"
          alt="Logo"
          class="h-16 sm:h-20 w-auto drop-shadow-md"
        />

        <!-- TITLE -->
        <div class="flex flex-col leading-tight text-center">
          <h1
            class="text-2xl sm:text-3xl md:text-4xl font-extrabold text-[#f4d37d] tracking-wide drop-shadow"
          >
            MODERN ASTROLOGY
          </h1>
          <p
            class="text-white font-semibold text-xs sm:text-sm tracking-wide px-2"
          >
            KRISHNAMURTI ACADEMY OF MODERN ASTROLOGY & SPIRITUAL DEVELOPMENT
          </p>
        </div>
      </div>

      <!-- ONE-LINE REGISTRATION INFO -->
      <p
        class="mt-3 text-white text-xs sm:text-sm font-semibold tracking-wide text-center px-2 sm:px-4"
      >
        Registered Under
        <span class="underline">Government of West Bengal</span> &
        <span class="underline">Government of India</span> • ISO Certified
        Institute •
        <span class="text-yellow-300 font-bold"
          >Registration Number Provided After Course Completion</span
        >
        • Official Certificate Every Semester
      </p>
    </header>

    <!-- NAVBAR -->
    <nav class="w-full bg-[#FDECC2] py-4">
      <ul
        class="flex flex-wrap justify-center gap-6 md:space-x-16 font-bold text-purple-800 text-lg tracking-wide"
      >
        <li><a href="index.html" class="hover:text-purple-600">HOME</a></li>
        <li>
          <a href="booking.html" class="hover:text-purple-600">CONSULTANCY</a>
        </li>

        <li style="animation: bounceRepeat 3s infinite">
          <a
            href="academic.html"
            class="bg-purple-800 text-white px-4 py-2 rounded-full shadow-lg"
            style="animation: purpleBlink 1s infinite ease-in-out"
          >
            ACADEMIC / COURSES
          </a>
        </li>

        <li>
          <a href="studentcorner.html" class="hover:text-purple-600"
            >STUDENT CORNER</a
          >
        </li>
        <li>
          <a href="contact.html" class="hover:text-purple-600">CONTACT</a>
        </li>
      </ul>
    </nav>

    <!-- FEES PAYMENT SECTION -->
    <section
      class="max-w-xl mx-auto bg-white shadow-lg p-6 mt-8 rounded-lg border"
    >
      <h2 class="text-2xl font-bold text-center text-purple-800 mb-4">
        Fees Payment Login
      </h2>

      <div class="space-y-4">
        <div>
          <label class="font-semibold">Batch Code</label>
          <input
            id="batch"
            type="text"
            class="w-full border border-gray-400 px-3 py-2 rounded mt-1"
            placeholder="Enter Batch Code"
          />
        </div>

        <div>
          <label class="font-semibold">Roll No</label>
          <input
            id="roll"
            type="text"
            class="w-full border border-gray-400 px-3 py-2 rounded mt-1"
            placeholder="Enter Roll No"
          />
        </div>
        <div>
          <label class="font-semibold">Name</label>
          <input
            id="studentName"
            type="text"
            class="w-full border border-gray-400 px-3 py-2 rounded mt-1 bg-gray-100"
            placeholder="Auto-filled"
            readonly
          />
        </div>

        <div>
          <label class="font-semibold">Email</label>
          <input
            id="studentEmail"
            type="text"
            class="w-full border border-gray-400 px-3 py-2 rounded mt-1 bg-gray-100"
            placeholder="Auto-filled"
            readonly
          />
        </div>

        <div>
          <label class="font-semibold">Password</label>
          <input
            id="password"
            type="password"
            class="w-full border border-gray-400 px-3 py-2 rounded mt-1"
            placeholder="Enter Password"
          />
        </div>

        <div class="flex justify-between text-sm">
          <a href="" class="text-purple-700 font-semibold hover:underline"
            >Forgot Password?</a
          >
        </div>

        <button
          onclick="navigaetdashboard()"
          class="w-full bg-purple-800 text-white py-2 rounded-md font-bold hover:bg-purple-900 transition"
        >
          Login
        </button>
      </div>
    </section>

    <!-- ALUMNI SECTION -->
    <section
      class="max-w-6xl mx-auto mt-10 p-6 bg-white shadow-lg rounded-lg border"
    >
      <h2 class="text-3xl font-bold text-purple-800 text-center mb-6">
        Alumni & Ongoing Students
      </h2>

      <!-- 2-Column Layout -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- LEFT — ALUMNI LISTING -->
        <div>
          <h3 class="text-2xl font-bold text-purple-700 mb-4 text-center">
            Alumni
          </h3>

          <!-- SEARCH -->
          <input
            type="text"
            id="alumniSearch"
            class="w-full border border-gray-400 px-4 py-2 rounded mb-4"
            placeholder="Search alumni by name"
          />

          <!-- ALUMNI CARDS -->
          <div id="alumniList" class="space-y-4"></div>
        </div>

        <!-- RIGHT — ONGOING STUDENTS LIST -->
        <div>
          <h3 class="text-2xl font-bold text-purple-700 mb-4 text-center">
            Ongoing Students
          </h3>

          <!-- SEARCH -->
          <input
            type="text"
            id="ongoingSearch"
            class="w-full border border-gray-400 px-4 py-2 rounded mb-4"
            placeholder="Search student by name"
          />

          <ul id="ongoingList" class="space-y-4"></ul>
        </div>
      </div>
    </section>

    <br /><br />

    <script>
      const API_BASE_URL = "http://localhost:5000/api/v1";

      // Pad roll number to 3 digits
      function padRoll(roll) {
        return roll.toString().padStart(3, "0");
      }

      // Fetch student name + email automatically
      async function fetchStudentDetails() {
        const batch = document.querySelector("#batch").value.trim();
        const roll = document.querySelector("#roll").value.trim();

        if (!batch || !roll) return;

        const paddedRoll = padRoll(roll);
        const studentId = `${batch}-${paddedRoll}`;

        try {
          const res = await fetch(`${API_BASE_URL}/student/basic/${studentId}`);
          const data = await res.json();

          if (res.ok) {
            // Auto-fill the fields
            document.querySelector("#studentName").value = data.name || "";
            document.querySelector("#studentEmail").value = data.email || "";
          } else {
            document.querySelector("#studentName").value = "";
            document.querySelector("#studentEmail").value = "";
          }
        } catch (error) {
          console.log("Fetch Error", error);
        }
      }

      // Call auto-fetch whenever batch or roll changes
      document
        .querySelector("#batch")
        .addEventListener("input", fetchStudentDetails);
      document
        .querySelector("#roll")
        .addEventListener("input", fetchStudentDetails);

      // LOGIN FUNCTION
      async function navigaetdashboard() {
        const batchCode = document.querySelector("#batch").value.trim();
        const rollNo = document.querySelector("#roll").value.trim();
        const password = document.querySelector("#password").value.trim();

        if (!batchCode || !rollNo || !password) {
          alert("Please fill all fields");
          return;
        }

        const paddedRoll = padRoll(rollNo);
        const studentId = `${batchCode}-${paddedRoll}`;

        const bodyData = { studentId, password };

        try {
          const res = await fetch(`${API_BASE_URL}/student/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(bodyData),
          });

          const data = await res.json();

          if (!res.ok) {
            alert(data.message || "Invalid login");
            return;
          }

          // Save student token
          localStorage.setItem("token", data.token);

          // Redirect to dashboard
          window.location.href = "studentdashboard.html";
        } catch (error) {
          console.error(error);
          alert("Server error");
        }
      }
    </script>
  </body>
</html>

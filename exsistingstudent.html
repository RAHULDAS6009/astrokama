<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register Existing Student</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Story+Script&family=TikTok+Sans:opsz,wght@12..36,300..900&family=Vend+Sans:ital,wght@0,300..700;1,300..700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      .lotus-title {
        background: linear-gradient(135deg, #8a1538, #f28c28, #e3c72f, #3ca66b);
        -webkit-background-clip: text;
        color: transparent;
      }

      body {
        background: linear-gradient(135deg, #f2f1ff 0%, #e9ffef 100%);
      }

      .story-script-regular {
        font-family: "Story Script", sans-serif;
      }

      .vend-sans {
        font-family: "Vend Sans", sans-serif;
      }

      @media (max-width: 768px) {
        .header-title {
          font-size: 1.5rem !important;
        }

        .header-subtitle {
          font-size: 0.65rem !important;
        }

        .nav-menu {
          flex-direction: column !important;
          gap: 0.5rem !important;
        }

        .nav-menu li {
          width: 100%;
          text-align: center;
        }

        .file-grid {
          grid-template-columns: 1fr !important;
        }
      }

      .info-banner {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        border-left: 4px solid #34d399;
      }
    </style>
  </head>

  <body class="bg-green-100">
    <header
      class="bg-[#523A35] border-b-4 border-[#D4A017] flex flex-col items-center px-4 md:px-6 py-4 shadow-md"
    >
      <div class="flex justify-center items-center space-x-2 md:space-x-4">
        <img
          src="academiclogo.png"
          alt="Logo"
          class="h-12 md:h-20 w-auto drop-shadow-md"
        />

        <div class="flex flex-col leading-tight text-center">
          <h1
            class="header-title text-2xl md:text-4xl font-extrabold text-[#f4d37d] tracking-wide drop-shadow"
          >
            MODERN ASTROLOGY
          </h1>

          <p
            class="header-subtitle text-white font-semibold text-xs md:text-sm tracking-wide"
          >
            KRISHNAMURTI ACADEMY OF MODERN ASTROLOGY & SPIRITUAL DEVELOPMENT
          </p>
        </div>
      </div>

      <p
        class="mt-3 text-white text-xs md:text-sm font-semibold tracking-wide text-center px-2 md:px-4"
      >
        Registered Under
        <span class="underline">Government of West Bengal</span> &
        <span class="underline">Government of India</span> ‚Ä¢ ISO Certified
        Institute ‚Ä¢
        <span class="text-yellow-300 font-bold"
          >Registration Number Provided After Course Completion</span
        >
        ‚Ä¢ Official Certificate Every Semester
      </p>
    </header>

    <nav class="w-full bg-[#FDECC2] py-3 md:py-4">
      <ul
        class="nav-menu flex justify-center space-x-4 md:space-x-16 font-bold text-purple-800 text-sm md:text-lg tracking-wide px-2"
      >
        <li><a href="/" class="hover:text-purple-600">HOME</a></li>
        <li>
          <a href="/booking.html" class="hover:text-purple-600">CONSULTANCY</a>
        </li>
        <li>
          <a
            href="/academic.html"
            class="bg-purple-800 text-white px-3 md:px-4 py-2 rounded-full shadow-lg hover:bg-purple-900"
          >
            ACADEMIC / COURSES
          </a>
        </li>

        <li>
          <a href="/studentcorner.html" class="hover:text-purple-600"
            >STUDENT CORNER</a
          >
        </li>
        <li>
          <a href="/contact.html" class="hover:text-purple-600">CONTACT</a>
        </li>
      </ul>
    </nav>

    <div
      class="max-w-3xl mx-auto bg-white shadow-xl p-4 md:p-8 my-6 md:my-10 rounded-xl mx-4"
    >
      <!-- Info Banner -->
      <div class="info-banner text-white p-4 rounded-lg mb-6">
        <div class="flex items-center justify-between">
          <div>
            <h3 class="font-bold text-lg">‚úì Existing Student Registration</h3>
            <p class="text-sm opacity-90">
              No admission fee required - For previous students only
            </p>
          </div>
          <div class="text-right">
            <p class="text-2xl font-bold">FREE</p>
            <p class="text-xs opacity-80">Database Entry</p>
          </div>
        </div>
      </div>

      <form id="registerForm" class="space-y-4 md:space-y-6">
        <h1
          class="w-full font-extrabold text-2xl md:text-4xl text-center rounded-md bg-green-100 py-3 md:py-4 border border-2 border-green-400"
        >
          Register Existing Student
        </h1>

        <!-- Name -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >1. Name of the Student <span class="text-red-500">*</span></label
          >
          <input
            id="name"
            type="text"
            class="w-full border px-3 py-2 rounded mt-1 text-sm md:text-base"
            required
            placeholder="Enter full name"
          />
        </div>

        <!-- Gender -->
        <div>
          <label class="font-semibold text-sm md:text-base">
            Gender <span class="text-red-500">*</span>
          </label>
          <select
            id="gender"
            class="w-full border px-3 py-2 rounded mt-1 text-sm md:text-base"
            required
          >
            <option value="">-- Select Gender --</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
            <option value="Other">Other</option>
          </select>
        </div>

        <!-- Guardian Name -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >2. Guardian Name <span class="text-red-500">*</span></label
          >
          <input
            id="guardianName"
            type="text"
            class="w-full border px-3 py-2 rounded mt-1 text-sm md:text-base"
            required
            placeholder="Enter guardian's name"
          />
        </div>

        <!-- Relation With Guardian -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >3. Relation With Guardian
            <span class="text-red-500">*</span></label
          >
          <select
            id="relation"
            class="w-full border px-3 py-2 rounded mt-1 text-sm md:text-base"
            required
          >
            <option value="">-- Select Relation --</option>
            <option value="Father">Father</option>
            <option value="Mother">Mother</option>
            <option value="Husband">Husband</option>
            <option value="Wife">Wife</option>
            <option value="Brother">Brother</option>
            <option value="Sister">Sister</option>
            <option value="Son">Son</option>
            <option value="Daughter">Daughter</option>
            <option value="Uncle">Uncle</option>
            <option value="Aunt">Aunt</option>
            <option value="Grandfather">Grandfather</option>
            <option value="Grandmother">Grandmother</option>
            <option value="Guardian">Legal Guardian</option>
            <option value="Other">Other</option>
          </select>
        </div>

        <!-- Other Relation -->
        <div id="otherRelationDiv" style="display: none">
          <label class="font-semibold text-sm md:text-base"
            >Specify Relation</label
          >
          <input
            id="otherRelation"
            type="text"
            class="w-full border px-3 py-2 rounded mt-1 text-sm md:text-base"
            placeholder="Please specify"
          />
        </div>

        <!-- Mode -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >Mode of Course <span class="text-red-500">*</span></label
          >
          <div
            class="flex flex-col md:flex-row items-start md:items-center gap-3 md:gap-6 mt-2"
          >
            <label class="flex items-center gap-2">
              <input
                type="radio"
                name="mode"
                value="Online"
                id="modeOnline"
                class="w-4 h-4"
              />
              <span class="text-sm md:text-base">Online</span>
            </label>
            <label class="flex items-center gap-2">
              <input
                type="radio"
                name="mode"
                value="Offline"
                id="modeOffline"
                class="w-4 h-4"
              />
              <span class="text-sm md:text-base">Offline</span>
            </label>
          </div>
        </div>

        <!-- Course -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >Branch Details <span class="text-red-500">*</span></label
          >
          <select
            id="courseSelect"
            class="w-full border px-3 py-2 rounded mt-1 text-sm md:text-base"
            required
          >
            <option value="">-- Select Branch --</option>
          </select>
        </div>

        <!-- Password -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >Password <span class="text-red-500">*</span></label
          >
          <div class="relative mt-1">
            <input
              id="passwordField"
              type="password"
              class="w-full border px-3 py-2 rounded text-sm md:text-base"
              required
              placeholder="Create a password"
              minlength="6"
            />
            <button
              type="button"
              onclick="togglePassword()"
              class="absolute right-3 md:right-4 top-1/2 -translate-y-1/2 text-gray-600 text-lg md:text-xl"
            >
              üëÅÔ∏è
            </button>
          </div>
          <p class="text-xs text-gray-500 mt-1">Minimum 6 characters</p>
        </div>

        <!-- Addresses -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >Communication Address <span class="text-red-500">*</span></label
          >
          <textarea
            id="commAddress"
            rows="2"
            class="w-full border px-3 py-2 rounded text-sm md:text-base"
            required
            placeholder="Enter your current address"
          ></textarea>
        </div>

        <div>
          <label class="font-semibold text-sm md:text-base"
            >Permanent Address <span class="text-red-500">*</span></label
          >
          <textarea
            id="permAddress"
            rows="2"
            class="w-full border px-3 py-2 rounded text-sm md:text-base"
            required
            placeholder="Enter your permanent address"
          ></textarea>
          <label class="flex items-center gap-2 mt-2">
            <input type="checkbox" id="sameAddress" class="w-4 h-4" />
            <span class="text-xs md:text-sm"
              >Same as communication address</span
            >
          </label>
        </div>

        <!-- Email -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >Email Address <span class="text-red-500">*</span></label
          >
          <input
            id="email"
            type="email"
            class="w-full border px-3 py-2 rounded text-sm md:text-base"
            required
            placeholder="example@email.com"
          />
          <p id="emailStatus" class="text-sm mt-1 font-semibold hidden"></p>
        </div>

        <!-- Mobile & WhatsApp -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
          <div>
            <label class="font-semibold text-sm md:text-base"
              >Mobile Number <span class="text-red-500">*</span></label
            >
            <input
              id="phone"
              type="tel"
              class="w-full border px-3 py-2 rounded text-sm md:text-base"
              required
              placeholder="10-digit mobile number"
              pattern="[0-9]{10}"
              maxlength="10"
            />
          </div>

          <div>
            <label class="font-semibold text-sm md:text-base"
              >WhatsApp Number <span class="text-red-500">*</span></label
            >
            <input
              id="whatsapp"
              type="tel"
              class="w-full border px-3 py-2 rounded text-sm md:text-base"
              required
              placeholder="10-digit WhatsApp number"
              pattern="[0-9]{10}"
              maxlength="10"
            />
            <label class="flex items-center gap-2 mt-2">
              <input type="checkbox" id="samePhone" class="w-4 h-4" />
              <span class="text-xs md:text-sm">Same as mobile number</span>
            </label>
          </div>
        </div>

        <!-- DOB -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >Date, Time & Place of Birth
            <span class="text-red-500">*</span></label
          >
          <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mt-1">
            <input
              id="dob"
              type="date"
              class="border px-3 py-2 rounded text-sm md:text-base"
              required
            />
            <input
              id="birthTime"
              type="time"
              class="border px-3 py-2 rounded text-sm md:text-base"
              required
            />
            <input
              id="birthPlace"
              type="text"
              class="border px-3 py-2 rounded text-sm md:text-base"
              placeholder="Place of Birth"
              required
            />
          </div>
        </div>

        <!-- Qualification -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >Educational Qualification
            <span class="text-red-500">*</span></label
          >
          <input
            id="qualification"
            type="text"
            class="w-full border px-3 py-2 rounded text-sm md:text-base"
            required
            placeholder="e.g., B.A., B.Sc., 12th Pass, etc."
          />
        </div>

        <!-- Extra Experience -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >Extra Experience</label
          >
          <input
            id="experience"
            type="text"
            class="w-full border px-3 py-2 rounded text-sm md:text-base"
            placeholder="Any additional experience or skills"
          />
        </div>

        <!-- Astro Experience -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >Astrological Experience (If Any)</label
          >
          <input
            id="astroExp"
            type="text"
            class="w-full border px-3 py-2 rounded text-sm md:text-base"
            placeholder="Previous knowledge in astrology"
          />
        </div>

        <!-- Occupation -->
        <div>
          <label class="font-semibold text-sm md:text-base">Occupation</label>
          <input
            id="occupation"
            type="text"
            class="w-full border px-3 py-2 rounded text-sm md:text-base"
            placeholder="Your current occupation"
          />
        </div>

        <!-- Files -->
        <div class="file-grid grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
          <div>
            <label class="font-semibold text-sm md:text-base"
              >Upload Photo</label
            >
            <input
              id="photo"
              type="file"
              accept="image/*"
              class="w-full border p-2 rounded text-xs md:text-sm"
            />
            <p class="text-xs text-gray-500 mt-1">Max 2MB</p>
          </div>

          <div>
            <label class="font-semibold text-sm md:text-base"
              >Upload Certificate</label
            >
            <input
              id="certificate"
              type="file"
              accept=".pdf,image/*"
              class="w-full border p-2 rounded text-xs md:text-sm"
            />
            <p class="text-xs text-gray-500 mt-1">PDF or Image (Max 5MB)</p>
          </div>

          <div>
            <label class="font-semibold text-sm md:text-base"
              >Upload ID Proof</label
            >
            <input
              id="idproof"
              type="file"
              accept=".pdf,image/*"
              class="w-full border p-2 rounded text-xs md:text-sm"
            />
            <p class="text-xs text-gray-500 mt-1">
              Aadhaar/PAN/Passport (Max 5MB)
            </p>
          </div>
        </div>

        <!-- Submit -->
        <div class="text-center mt-6 md:mt-8">
          <button
            id="submitBtn"
            type="submit"
            class="bg-green-600 text-white px-8 md:px-10 py-3 rounded-lg shadow-lg hover:bg-green-700 w-full md:w-auto text-sm md:text-base font-semibold"
          >
            Register Student (No Payment Required)
          </button>
        </div>
      </form>

      <!-- Student ID Box (Hidden by Default) -->
      <div
        id="studentIdBox"
        class="hidden mt-10 p-6 bg-green-50 border border-green-400 rounded-lg shadow-lg text-center"
      >
        <h2 class="text-xl md:text-2xl font-bold text-green-800">
          üéâ Registration Successful!
        </h2>

        <p class="mt-3 text-lg font-semibold text-green-700">
          Student ID Generated:
        </p>

        <p
          id="generatedStudentId"
          class="text-3xl font-extrabold text-green-900 mt-1 tracking-wide"
        ></p>

        <p class="mt-4 text-red-600 font-semibold text-sm md:text-base">
          ‚ö† Please take a screenshot of your Student ID ‚Äî you will need it for
          login.
        </p>

        <button
          onclick="goToDashboard()"
          class="mt-6 bg-purple-700 text-white px-6 py-3 rounded-lg font-bold shadow hover:bg-purple-900"
        >
          Go to Student Dashboard
        </button>
      </div>
    </div>

    <!-- Upload Progress Modal -->
    <div
      id="uploadModal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50"
    >
      <div class="bg-white rounded-xl shadow-xl w-80 p-6 text-center">
        <h3 class="text-lg font-bold text-green-700 mb-4">
          Uploading Documents
        </h3>

        <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
          <div
            id="modalProgress"
            class="bg-green-500 h-3 w-0 transition-all"
          ></div>
        </div>

        <p id="modalText" class="text-sm mt-3 text-gray-700">
          Starting upload...
        </p>
      </div>
    </div>

    <script>
      function goToDashboard() {
        window.location.href = "studentcorner.html";
      }

      let selectedCourseData = null;
      let emailCheckTimer = null;
      let emailAlreadyExists = false;

      function togglePassword() {
        const input = document.getElementById("passwordField");
        input.type = input.type === "password" ? "text" : "password";
      }

      // Email checking function
      async function checkEmailExists(email) {
        const res = await fetch(
          "https://api.rahuldev.live/api/v1/admission/check-email",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email }),
          }
        );
        const data = await res.json();
        return data.exists === true;
      }

      // Email validation with debounce
      document.getElementById("email").addEventListener("input", function () {
        const email = this.value.trim();
        const status = document.getElementById("emailStatus");

        emailAlreadyExists = false;
        status.classList.add("hidden");

        if (!email || !email.includes("@")) return;

        clearTimeout(emailCheckTimer);

        emailCheckTimer = setTimeout(async () => {
          status.textContent = "Checking email...";
          status.className = "text-sm mt-1 font-semibold text-gray-500";

          try {
            const exists = await checkEmailExists(email);

            if (exists) {
              emailAlreadyExists = true;
              status.textContent = "‚ùå Email already registered. Please login.";
              status.className = "text-sm mt-1 font-semibold text-red-600";
            } else {
              status.textContent = "‚úÖ Please Proceed";
              status.className = "text-sm mt-1 font-semibold text-green-600";
            }
          } catch (err) {
            status.textContent = "‚ö†Ô∏è Unable to check email";
            status.className = "text-sm mt-1 font-semibold text-orange-600";
          }

          status.classList.remove("hidden");
        }, 500);
      });

      document
        .getElementById("relation")
        .addEventListener("change", function () {
          const otherDiv = document.getElementById("otherRelationDiv");
          const otherInput = document.getElementById("otherRelation");

          if (this.value === "Other") {
            otherDiv.style.display = "block";
            otherInput.required = true;
          } else {
            otherDiv.style.display = "none";
            otherInput.required = false;
            otherInput.value = "";
          }
        });

      document
        .getElementById("sameAddress")
        .addEventListener("change", function () {
          if (this.checked) {
            document.getElementById("permAddress").value =
              document.getElementById("commAddress").value;
          }
        });

      document
        .getElementById("samePhone")
        .addEventListener("change", function () {
          if (this.checked) {
            document.getElementById("whatsapp").value =
              document.getElementById("phone").value;
          }
        });

      const selectedBranchCode = sessionStorage.getItem("selectedBranchCode");

      async function loadCourses() {
        try {
          const res = await fetch("https://api.rahuldev.live/api/branches");
          const branches = await res.json();

          if (!Array.isArray(branches)) {
            alert("Failed to load branches");
            return;
          }

          const select = document.getElementById("courseSelect");
          select.innerHTML = `<option value="">-- Select Branch --</option>`;

          let autoSelectValue = null;

          branches.forEach((branch) => {
            const firstSemester =
              Array.isArray(branch.semsters) && branch.semsters.length > 0
                ? branch.semsters[0]
                : null;

            const payload = {
              branchId: branch.id,
              branchName: branch.name,
              branchCode: branch.branchCode,
              courseType: branch.tabHeader1 || "Course",
              days: branch.daysJSON || "",
              semesterId: firstSemester?.id || null,
              semesterName: firstSemester?.name || "First Semester",
              admissionFee:
                firstSemester?.admissionFee ?? branch.admissionfee ?? 0,
              isoffline: branch.isoffline === true,
            };

            const option = document.createElement("option");
            option.value = JSON.stringify(payload);
            option.textContent = `[${payload.branchCode}] ${payload.branchName} - ${payload.days}`;

            // Auto-match by branch code
            if (
              selectedBranchCode &&
              String(branch.branchCode).trim() ===
                String(selectedBranchCode).trim()
            ) {
              autoSelectValue = option.value;
              selectedCourseData = payload;
            }

            select.appendChild(option);
          });

          // Auto-select branch
          if (autoSelectValue) {
            select.value = autoSelectValue;
            handleBranchSelection(JSON.parse(autoSelectValue));
          }
        } catch (err) {
          console.error("Load branches error:", err);
          alert("Error loading branches");
        }
      }

      function lockCourseMode(isOffline) {
        const onlineRadio = document.getElementById("modeOnline");
        const offlineRadio = document.getElementById("modeOffline");

        if (isOffline === true) {
          offlineRadio.checked = true;
          offlineRadio.disabled = false;
          onlineRadio.checked = false;
          onlineRadio.disabled = true;
        } else {
          onlineRadio.checked = true;
          onlineRadio.disabled = false;
          offlineRadio.checked = false;
          offlineRadio.disabled = true;
        }
      }

      function handleBranchSelection(courseData) {
        selectedCourseData = courseData;
        lockCourseMode(courseData.isoffline === true);
      }

      document
        .getElementById("courseSelect")
        .addEventListener("change", function () {
          if (!this.value) return;
          handleBranchSelection(JSON.parse(this.value));
        });

      loadCourses();

      function uploadFile(file) {
        return new Promise((resolve, reject) => {
          if (!file) return resolve(null);

          const isPDF = file.type === "application/pdf";
          const maxSize = isPDF ? 5 * 1024 * 1024 : 2 * 1024 * 1024;

          if (file.size > maxSize) {
            alert(
              `‚ùå ${file.name} is too large.\n\nPDF limit: 5MB\nImages limit: 2MB`
            );
            return reject("FILE_TOO_LARGE");
          }

          const modal = document.getElementById("uploadModal");
          const progressBar = document.getElementById("modalProgress");
          const text = document.getElementById("modalText");

          modal.classList.remove("hidden");
          modal.classList.add("flex");
          progressBar.style.width = "0%";
          text.textContent = `Uploading ${file.name}...`;

          const xhr = new XMLHttpRequest();
          const formData = new FormData();
          formData.append("file", file);

          xhr.open("POST", "https://api.rahuldev.live/upload-file", true);

          xhr.upload.onprogress = (e) => {
            if (e.lengthComputable) {
              const percent = Math.round((e.loaded / e.total) * 100);
              progressBar.style.width = percent + "%";
              text.textContent = `Uploading ${file.name} (${percent}%)`;
            }
          };

          xhr.onload = () => {
            modal.classList.add("hidden");
            modal.classList.remove("flex");

            if (xhr.status === 200) {
              const res = JSON.parse(xhr.responseText);
              if (res.success && res.url) {
                resolve(res.url);
              } else {
                reject("Upload failed");
              }
            } else {
              reject("Upload failed");
            }
          };

          xhr.onerror = () => {
            modal.classList.add("hidden");
            modal.classList.remove("flex");
            reject("Network error");
          };

          xhr.send(formData);
        });
      }

      document
        .getElementById("registerForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          if (emailAlreadyExists) {
            alert("This email is already registered. Please login.");
            return;
          }

          const submitBtn = document.getElementById("submitBtn");
          submitBtn.disabled = true;
          submitBtn.textContent = "Processing...";

          try {
            if (!selectedCourseData) {
              alert("Please select a course.");
              submitBtn.disabled = false;
              submitBtn.textContent = "Register Student (No Payment Required)";
              return;
            }

            submitBtn.textContent = "Uploading files...";

            const photoFile = document.getElementById("photo").files[0];
            const certificateFile =
              document.getElementById("certificate").files[0];
            const idProofFile = document.getElementById("idproof").files[0];

            const fileUrls = {
              photoUrl: photoFile ? await uploadFile(photoFile) : null,
              certificateUrl: certificateFile
                ? await uploadFile(certificateFile)
                : null,
              idProofUrl: idProofFile ? await uploadFile(idProofFile) : null,
            };

            let relationValue = document.getElementById("relation").value;
            if (relationValue === "Other") {
              relationValue = document
                .getElementById("otherRelation")
                .value.trim();
            }

            const formData = {
              name: document.getElementById("name").value.trim(),
              email: document.getElementById("email").value.trim(),
              password: document.getElementById("passwordField").value,
              courseId: parseInt(selectedCourseData.courseId, 10),
              branchId: selectedCourseData.branchId,
              courseDetails: `${selectedCourseData.courseType} - ${selectedCourseData.branchName}`,
              courseMode:
                document.querySelector("input[name='mode']:checked")?.value ||
                "Online",
              gurdianName: document.getElementById("guardianName").value.trim(),
              gender: document.getElementById("gender").value,
              relationWithGurdain: relationValue,
              communicationAddress: document
                .getElementById("commAddress")
                .value.trim(),
              permanentAddress: document
                .getElementById("permAddress")
                .value.trim(),
              mobileNumber: document.getElementById("phone").value.trim(),
              whatsappNumber: document.getElementById("whatsapp").value.trim(),
              dateOfBirth: document.getElementById("dob").value,
              placeOfBirth: document.getElementById("birthPlace").value.trim(),
              educationalQualification: document
                .getElementById("qualification")
                .value.trim(),
              extraExperience:
                document.getElementById("experience").value.trim() || null,
              astrologicalExperience:
                document.getElementById("astroExp").value.trim() || null,
              occupation:
                document.getElementById("occupation").value.trim() || null,
              ...fileUrls,
            };

            submitBtn.textContent = "Registering student...";

            const admissionRes = await fetch(
              "https://api.rahuldev.live/api/v1/admission",
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(formData),
              }
            );

            const admissionJson = await admissionRes.json();

            if (admissionJson && admissionJson.success) {
              const studentIdBox = document.getElementById("studentIdBox");
              const generatedId = document.getElementById("generatedStudentId");

              studentIdBox.classList.remove("hidden");
              generatedId.textContent =
                admissionJson.data?.student?.studentId || "N/A";

              studentIdBox.scrollIntoView({ behavior: "smooth" });

              submitBtn.textContent = "Registration Completed ‚úì";
              submitBtn.classList.remove("bg-green-600", "hover:bg-green-700");
              submitBtn.classList.add("bg-gray-400", "cursor-not-allowed");
            } else {
              alert(
                "‚ùå Registration failed: " +
                  (admissionJson.message || "Unknown error")
              );
              submitBtn.disabled = false;
              submitBtn.textContent = "Register Student (No Payment Required)";
            }
          } catch (err) {
            console.error("Submit error:", err);
            alert("Something went wrong: " + err.message);
            submitBtn.disabled = false;
            submitBtn.textContent = "Register Student (No Payment Required)";
          }
        });
    </script>
  </body>
</html>

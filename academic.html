<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Astrologer Suvendu Paul</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      .animated-gradient {
        background: linear-gradient(270deg, #34d399, #10b981, #059669, #047857);
        background-size: 600% 600%;
        animation: gradientAnimation 8s ease infinite;
      }

      @keyframes gradientAnimation {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      @keyframes bounceRepeat {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      @keyframes purpleBlink {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
      }

      body {
        background: linear-gradient(135deg, #f2f1ff 0%, #e9ffef 100%);
      }

      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }

      /* Loading spinner */
      .banner-loading {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 400px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid white;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>

  <body>
    <!-- HEADER -->
    <header
      class="bg-[#523A35] border-b-4 border-[#D4A017] flex flex-col items-center px-4 sm:px-6 py-4 shadow-md"
    >
      <div
        class="flex flex-col sm:flex-row justify-center items-center space-y-3 sm:space-y-0 sm:space-x-4"
      >
        <img
          src="academiclogo.png"
          alt="Logo"
          class="h-16 sm:h-20 w-auto drop-shadow-md"
        />
        <div class="flex flex-col leading-tight text-center">
          <h1
            class="text-2xl sm:text-3xl md:text-4xl font-extrabold text-[#f4d37d] tracking-wide drop-shadow"
          >
            MODERN ASTROLOGY
          </h1>
          <p
            class="text-white font-semibold text-xs sm:text-sm tracking-wide px-2"
          >
            KRISHNAMURTI ACADEMY OF MODERN ASTROLOGY & SPIRITUAL DEVELOPMENT
          </p>
        </div>
      </div>

      <p
        class="mt-3 text-white text-xs sm:text-sm font-semibold tracking-wide text-center px-2 sm:px-4"
      >
        Registered Under
        <span class="underline">Government of West Bengal</span> &
        <span class="underline">Government of India</span> • ISO Certified
        Institute •
        <span class="text-yellow-300 font-bold"
          >Registration Number Provided After Course Completion</span
        >
        • Official Certificate Every Semester
      </p>
    </header>

    <!-- Nav Bar -->
    <!-- Add this STYLE section in your <head> or before </head> -->
    <style>
      @keyframes bounceRepeat {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      @keyframes purpleBlink {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
      }

      #mobileMenu {
        transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out;
        overflow: hidden;
        max-height: 0;
        opacity: 0;
      }

      #mobileMenu.menu-open {
        max-height: 500px;
        opacity: 1;
      }
    </style>

    <!-- Replace your existing <nav> with this complete navbar -->
    <nav class="w-full bg-[#FDECC2] py-3 sm:py-4">
      <div class="container mx-auto px-4">
        <!-- Mobile Menu Button (visible only on mobile) -->
        <div class="flex justify-between items-center md:hidden">
          <span class="font-bold text-purple-800 text-lg">MENU</span>
          <button
            id="menuBtn"
            class="text-purple-800 focus:outline-none"
            aria-label="Toggle menu"
          >
            <svg
              id="hamburger"
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              ></path>
            </svg>
            <svg
              id="close"
              class="w-6 h-6 hidden"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
          </button>
        </div>

        <!-- Desktop Menu (visible on medium screens and up) -->
        <ul
          class="hidden md:flex flex-wrap justify-center gap-3 sm:gap-4 md:gap-6 lg:space-x-16 font-bold text-purple-800 text-sm sm:text-base md:text-lg tracking-wide"
        >
          <li><a href="/" class="hover:text-purple-600">HOME</a></li>
          <li>
            <a href="/booking.html" class="hover:text-purple-600"
              >CONSULTANCY</a
            >
          </li>
          <li style="animation: bounceRepeat 3s infinite">
            <a
              href="/academic.html"
              class="bg-purple-800 text-white px-3 sm:px-4 py-2 rounded-full shadow-lg text-xs sm:text-base"
              style="animation: purpleBlink 1s infinite ease-in-out"
            >
              ACADEMIC / COURSES
            </a>
          </li>
          <li>
            <a href="/studentcorner.html" class="hover:text-purple-600"
              >STUDENT CORNER</a
            >
          </li>
          <li>
            <a href="/contact.html" class="hover:text-purple-600">CONTACT</a>
          </li>
          <li>
            <a href="/gallery.html" class="hover:text-purple-600">GALLERY</a>
          </li>
        </ul>

        <!-- Mobile Menu (toggleable on mobile) -->
        <ul
          id="mobileMenu"
          class="md:hidden mt-4 space-y-3 font-bold text-purple-800 text-base tracking-wide"
        >
          <li><a href="/" class="block hover:text-purple-600 py-2">HOME</a></li>
          <li>
            <a href="/booking.html" class="block hover:text-purple-600 py-2"
              >CONSULTANCY</a
            >
          </li>
          <li>
            <a
              href="/academic.html"
              class="block bg-purple-800 animate-bounce text-white px-4 py-2 rounded-full shadow-lg text-center"
            >
              ACADEMIC / COURSES
            </a>
          </li>
          <li>
            <a
              href="/studentcorner.html"
              class="block hover:text-purple-600 py-2"
              >STUDENT CORNER</a
            >
          </li>
          <li>
            <a href="/contact.html" class="block hover:text-purple-600 py-2"
              >CONTACT</a
            >
          </li>
          <li>
            <a href="/gallery.html" class="block hover:text-purple-600 py-2"
              >GALLERY</a
            >
          </li>
        </ul>
      </div>
    </nav>

    <!-- Add this SCRIPT section before </body> -->
    <script>
      const menuBtn = document.getElementById("menuBtn");
      const mobileMenu = document.getElementById("mobileMenu");
      const hamburger = document.getElementById("hamburger");
      const close = document.getElementById("close");

      if (menuBtn) {
        menuBtn.addEventListener("click", function () {
          mobileMenu.classList.toggle("menu-open");
          hamburger.classList.toggle("hidden");
          close.classList.toggle("hidden");
        });
      }
    </script>

    <!-- BANNER CAROUSEL -->
    <div class="relative w-full overflow-hidden shadow-lg">
      <!-- Loading State -->
      <div id="bannerLoading" class="banner-loading">
        <div class="spinner"></div>
      </div>

      <!-- Slides Container -->
      <div
        id="carousel"
        class="flex transition-transform duration-700 ease-in-out"
        style="display: none"
      >
        <!-- Images will be injected here by JavaScript -->
      </div>

      <!-- Dots Container -->
      <div
        id="dotsContainer"
        class="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2"
        style="display: none"
      >
        <!-- Dots will be injected here by JavaScript -->
      </div>
    </div>

    <script>
      // ======================
      // LOAD BANNER IMAGES FOR ACADEMIC PAGE
      // ======================
      let carouselInterval;

      async function loadBannerImages() {
        const carousel = document.getElementById("carousel");
        const dotsContainer = document.getElementById("dotsContainer");
        const loading = document.getElementById("bannerLoading");

        try {
          const res = await fetch("https://api.rahuldev.live/api/v1/cms");
          const { data } = await res.json();

          // Find academic_banner_section
          const bannerSection = data.find(
            (item) => item.section === "academic_banner_section"
          );

          if (!bannerSection || !bannerSection.content) {
            throw new Error("No banner data found");
          }

          // Parse the JSON array of image URLs
          const imageUrls = JSON.parse(bannerSection.content);

          if (!imageUrls || imageUrls.length === 0) {
            throw new Error("No images in banner data");
          }

          // Clear existing content
          carousel.innerHTML = "";
          dotsContainer.innerHTML = "";

          // Add images to carousel
          imageUrls.forEach((url, index) => {
            const img = document.createElement("img");
            img.src = url;
            img.alt = `Banner ${index + 1}`;
            img.className =
              "w-full h-[220px] md:h-[320px] lg:h-[400px] object-cover flex-shrink-0";
            carousel.appendChild(img);

            // Create dot for each image
            const dot = document.createElement("button");
            dot.className = "dot w-3 h-3 bg-white/50 rounded-full";
            dot.setAttribute("data-index", index);
            dotsContainer.appendChild(dot);
          });

          // Hide loading, show carousel
          loading.style.display = "none";
          carousel.style.display = "flex";
          dotsContainer.style.display = "flex";

          // Initialize carousel
          initializeCarousel(imageUrls.length);
        } catch (error) {
          console.error("Failed to load banner images:", error);
          loading.innerHTML =
            '<p class="text-white text-center">Failed to load banner images</p>';
        }
      }

      // ======================
      // CAROUSEL CONTROLS
      // ======================
      function initializeCarousel(slideCount) {
        const carousel = document.getElementById("carousel");
        const dots = document.querySelectorAll(".dot");
        let index = 0;

        function updateCarousel() {
          carousel.style.transform = `translateX(-${index * 100}%)`;

          dots.forEach((dot) => dot.classList.remove("bg-white"));
          dots[index].classList.add("bg-white");
        }

        function autoSlide() {
          index = (index + 1) % slideCount;
          updateCarousel();
        }

        // Dot click handlers
        dots.forEach((dot, i) => {
          dot.addEventListener("click", () => {
            index = i;
            updateCarousel();

            // Reset auto-slide timer
            clearInterval(carouselInterval);
            carouselInterval = setInterval(autoSlide, 3000);
          });
        });

        updateCarousel();
        carouselInterval = setInterval(autoSlide, 3000);
      }

      // Load banner on page load
      loadBannerImages();
    </script>

    <!-- SECTION 1 -->
    <section
      class="max-w-7xl mx-auto flex flex-col md:flex-row w-full items-start gap-5 px-4 sm:px-6 md:px-10 py-6 sm:py-10"
    >
      <!-- CONTENT -->
      <div class="w-full">
        <div
          class="bg-red-100 text-pink-800 text-lg sm:text-xl font-bold px-2 py-2 sm:py-3 rounded-tr-2xl shadow w-full"
        >
          Modern Astrology Institute
        </div>

        <div
          id="modern-astro-content-1"
          class="text-sm px-2 sm:text-base text-gray-600 leading-relaxed space-y-4 mt-4"
        ></div>
      </div>
    </section>

    <!-- SECTION 2 -->
    <section
      class="max-w-7xl mx-auto flex flex-col md:flex-row w-full items-start gap-5 px-4 sm:px-6 md:px-10 pb-8 sm:pb-14"
    >
      <!-- CONTENT -->
      <div class="w-full order-1 md:order-2">
        <div
          class="text-pink-800 text-lg sm:text-xl font-bold px-2 py-2 sm:py-3 w-fit"
        >
          A Different Kind of Learning
        </div>

        <div
          id="modern-astro-content-2"
          class="text-sm sm:text-base text-gray-600 px-2 leading-relaxed space-y-4 mt-4"
        ></div>
      </div>
    </section>

    <script>
      async function loadCMS() {
        try {
          const res = await fetch("https://api.rahuldev.live/api/v1/cms");
          const { data } = await res.json();

          renderSection(
            data,
            "modern_astrology_para_about_me_1",
            "modern-astro-content-1",
            "modern-astro-image-1"
          );

          renderSection(
            data,
            "modern_astrology_para_about_me_2",
            "modern-astro-content-2",
            "modern-astro-image-2"
          );
        } catch (err) {
          console.error("CMS load failed", err);
        }
      }

      function renderSection(data, sectionKey, contentId, imageId) {
        const section = data.find((item) => item.section === sectionKey);
        if (!section) return;

        const contentEl = document.getElementById(contentId);
        const imageEl = document.getElementById(imageId);

        if (contentEl) {
          contentEl.innerHTML = section.content || "";
        }

        if (imageEl) {
          imageEl.innerHTML = section.imageUrl
            ? `<img src="${section.imageUrl}" alt="${sectionKey}" class="w-full h-full object-cover" />`
            : "";
        }
      }

      loadCMS();
    </script>

    <!-- COURSE STRUCTURE -->
    <section
      class="w-full max-w-6xl mx-auto bg-violet-100 rounded-2xl shadow-lg relative overflow-hidden p-4 sm:p-6 mb-8 sm:mb-10"
    >
      <div
        class="absolute inset-0 bg-gradient-to-br from-purple-300 via-indigo-200 to-pink-200 opacity-50"
      ></div>

      <div class="text-center mb-6 sm:mb-10 relative">
        <h2
          class="text-2xl sm:text-3xl font-bold border-2 border-purple-400 rounded-xl px-4 sm:px-6 py-2 sm:py-3 inline-block text-purple-900 mt-4 sm:mt-6"
        >
          Course Structure
        </h2>
      </div>

      <div
        id="courseGrid"
        class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 relative pb-4"
      ></div>
    </section>

    <!-- PDF MODAL -->
    <div
      id="pdfModal"
      class="fixed inset-0 bg-black bg-opacity-70 hidden z-50 flex items-center justify-center p-4"
    >
      <div
        class="bg-white rounded-2xl w-full sm:w-11/12 md:w-3/4 h-[90vh] sm:h-3/4 p-3 sm:p-4 relative"
      >
        <button
          id="closePdf"
          class="absolute top-2 right-3 text-2xl font-bold text-black hover:text-gray-600"
        >
          ×
        </button>

        <iframe
          id="pdfFrame"
          src=""
          class="w-full h-full rounded-xl"
          frameborder="0"
        ></iframe>
      </div>
    </div>

    <script>
      const COURSE_API = "https://api.rahuldev.live/api/v1/admin/allcourse";

      async function fetchCourses() {
        try {
          const res = await fetch(COURSE_API);
          const json = await res.json();

          if (!json.success) return;

          renderCourses(json.data);
        } catch (err) {
          console.error("Failed to load courses", err);
        }
      }

      function renderCourses(courses) {
        const grid = document.getElementById("courseGrid");
        grid.innerHTML = "";

        courses.forEach((course) => {
          const titles = Array.isArray(course.gridTitle)
            ? course.gridTitle
            : [];

          const titleHTML = titles.map((t) => `<span>${t}</span>`).join("");

          grid.insertAdjacentHTML(
            "beforeend",
            `
        <div
          class="bg-violet-200/70 rounded-3xl p-4 hover:scale-105 transition duration-300 shadow-md border border-purple-300 flex flex-col"
        >
          <h3
            class="font-bold mb-3 flex flex-col text-base sm:text-lg text-purple-900 text-center min-h-[56px] items-center justify-center"
          >
            ${titleHTML}
          </h3>

          ${
            course.bannerimage
              ? `
                <img
                  src="${course.bannerimage}"
                  alt="${course.name}"
                  class="rounded-xl mb-3 h-40 sm:h-48 w-full object-cover"
                />
              `
              : `
                <div
                  class="h-40 sm:h-48 flex items-center justify-center bg-purple-100 rounded-xl mb-3 text-sm text-purple-600"
                >
                  No Image
                </div>
              `
          }

          <p class="text-purple-800 mb-4 flex-grow text-sm sm:text-base text-center">
            ${course.description || ""}
          </p>

          ${
            course.bannerpdf
              ? `
                <button
                  class="viewPdfBtn px-3 sm:px-4 py-2 bg-purple-500 hover:bg-purple-400 text-white rounded-lg font-semibold w-full transition text-sm sm:text-base"
                  data-pdf="${course.bannerpdf}"
                >
                  View PDF
                </button>
              `
              : `
                <button
                  class="px-3 sm:px-4 py-2 bg-gray-400 text-white rounded-lg font-semibold w-full cursor-not-allowed"
                  disabled
                >
                  PDF Not Available
                </button>
              `
          }
        </div>
      `
          );
        });
      }

      function initPdfViewer() {
        const modal = document.getElementById("pdfModal");
        const frame = document.getElementById("pdfFrame");
        const closeBtn = document.getElementById("closePdf");

        document.body.addEventListener("click", (e) => {
          const btn = e.target.closest(".viewPdfBtn");
          if (!btn) return;

          frame.src = btn.dataset.pdf;
          modal.classList.remove("hidden");
        });

        closeBtn.addEventListener("click", () => {
          frame.src = "";
          modal.classList.add("hidden");
        });

        modal.addEventListener("click", (e) => {
          if (e.target === modal) {
            frame.src = "";
            modal.classList.add("hidden");
          }
        });
      }

      initPdfViewer();
      fetchCourses();
    </script>

    <!-- COURSE DETAILS SECTION -->
    <div class="pt-6 sm:pt-10 max-w-7xl mx-auto px-4 sm:px-6 pb-10">
      <div class="max-w-7xl mx-auto bg-white p-4 sm:p-6 shadow-lg rounded-xl">
        <h2
          class="text-2xl sm:text-3xl font-bold text-purple-900 mb-6 text-center"
        >
          Course Details
        </h2>

        <div
          class="flex flex-wrap border-b overflow-x-auto no-scrollbar"
          id="mainTabs"
        ></div>
        <div id="contentArea" class="mt-4 sm:mt-6"></div>

        <div class="w-full flex justify-center">
          <button
            class="mt-4 px-4 sm:px-6 bg-purple-700 hover:bg-purple-800 text-white py-2 sm:py-3 rounded-lg font-semibold transition text-sm sm:text-base"
            onclick="window.location.href='admissionform.html'"
          >
            Take Admission
          </button>
        </div>
      </div>
    </div>

    <script>
      let branchesData = [];
      let currentTabId = null;
      let currentSubIndex = 0;
      let isLoading = true;

      function normalizeTab(text) {
        return (text || "").toLowerCase().replace(/\s+/g, " ").trim();
      }

      async function fetchBranches() {
        try {
          const response = await fetch(
            "https://api.rahuldev.live/api/branches"
          );
          branchesData = await response.json();

          branchesData = branchesData.map((b) => ({
            ...b,
            tabHeader1: b.tabHeader1 || "OTHER",
            tabHeader2: b.tabHeader2 || "",
            location: b.location || { location: "OTHER LOCATION" },
            semsters: Array.isArray(b.semsters) ? b.semsters : [],
          }));

          isLoading = false;
          renderMainTabs();
          renderContent();
        } catch (error) {
          console.error(error);
        }
      }

      function handleDayClick(branchCode) {
        console.log("Selected Branch Code:", branchCode);

        sessionStorage.setItem("selectedBranchCode", branchCode);

        document
          .querySelectorAll("[id^='admissionHint-']")
          .forEach((el) => el.classList.add("hidden"));

        const hint = document.getElementById(`admissionHint-${branchCode}`);
        if (hint) hint.classList.remove("hidden");
      }

      function goToAdmission() {
        window.location.href = "admissionform.html";
      }

      function renderMainTabs() {
        const container = document.getElementById("mainTabs");

        const groupedTabs = {};

        branchesData.forEach((b) => {
          const normalizedKey = `${normalizeTab(b.tabHeader1)}|${normalizeTab(
            b.tabHeader2
          )}`;

          if (!groupedTabs[normalizedKey]) {
            groupedTabs[normalizedKey] = {
              displayHeader1: b.tabHeader1,
              displayHeader2: b.tabHeader2,
              branches: [],
            };
          }

          groupedTabs[normalizedKey].branches.push(b);
        });

        if (!currentTabId) currentTabId = Object.keys(groupedTabs)[0];

        container.innerHTML = Object.keys(groupedTabs)
          .map((key) => {
            const tab = groupedTabs[key];
            return `
      <button
    onclick="switchTab('${key}')"
    class="px-4 py-2 font-semibold border-b-4 flex flex-col ${
      key === currentTabId
        ? "text-purple-700 border-purple-700"
        : "text-gray-600 border-transparent"
    }">
   <span> ${tab.displayHeader1}</span>
   <span> ${tab.displayHeader2}</span>
  </button>`;
          })
          .join("");
      }

      function renderMergedBranch(branches) {
        const base = branches[0];

        return `
    <div class="bg-[#f8f4ff] rounded-xl p-6 space-y-6">

      <h2 class="text-xl font-bold text-purple-800">
        ${base.location.location} (${base.tabHeader2})
      </h2>
${
  base.uploadPhoto1 || base.uploadPhoto2 || base.text
    ? `
  <div>
    ${
      base.uploadPhoto1 || base.uploadPhoto2
        ? `
      <h3 class="font-semibold mb-2">Course Photos:</h3>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        ${
          base.uploadPhoto1
            ? `<img src="${base.uploadPhoto1}" class="rounded-lg border" />`
            : ""
        }
        ${
          base.uploadPhoto2
            ? `<img src="${base.uploadPhoto2}" class="rounded-lg border" />`
            : ""
        }
      </div>
      `
        : ""
    }

    ${
      base.text
        ? `
        ${base.text}
      `
        : ""
    }
  </div>`
    : ""
}

      <ul class="space-y-1 text-gray-800">
        <li>• <strong>Duration:</strong> ${base.durationMonths} Year</li>
        <li>• <strong>Module:</strong> ${base.module}</li>
        <li>• <strong>Class:</strong> Weekly ${base.daysPerWeek} Day</li>
        <li>• <strong>Time:</strong> ${base.classHour} Hours</li>
      </ul>

      <hr />

      <h3 class="font-semibold">Select Your Available Days:</h3>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
  ${branches
    .map((b) => {
      let days = [];

      try {
        const parsed = JSON.parse(b.daysJSON);

        Object.keys(parsed).forEach((day) => {
          if (parsed[day]) {
            days.push(day.toUpperCase());
          }
        });
      } catch (e) {
        days = [b.daysJSON];
      }

      return `
        <div class="bg-white border rounded-lg p-4 space-y-2">
          ${days
            .map(
              (day) => `
            <div 
              class="px-3 py-2 border rounded cursor-pointer hover:bg-purple-100 transition"
              onclick="handleDayClick('${b.branchCode}')"
            >
              ${day}
            </div>
          `
            )
            .join("")}

          <p 
            id="admissionHint-${b.branchCode}" 
            class="hidden mt-2 text-purple-700 font-semibold cursor-pointer"
          >
          Click On Take Admission Button
          </p>
        </div>
      `;
    })
    .join("")}
</div>

      <h3 class="font-semibold text-purple-800">Fees Structure:</h3>
      <div class="bg-white border rounded-lg p-4">
        <div class="flex justify-between">
          <span>${base.noofsemster} Semester Admission</span>
          <span>${base.admissionfee} × ${base.noofsemster} =
            ${base.admissionfee * base.noofsemster}</span>
        </div>
        <div class="flex justify-between mt-1">
          <span>${base.durationMonths} Month Fees</span>
          <span>${base.monthlyfee} × ${base.durationMonths} =
            ${base.monthlyfee * base.durationMonths}</span>
        </div>
        <hr class="my-2">
        <div class="flex justify-between font-bold text-lg">
          <span>Total</span>
          <span>₹${
            base.admissionfee * base.noofsemster +
            base.monthlyfee * base.durationMonths
          }</span>
        </div>
      </div>

    
    </div>`;
      }

      function renderContent() {
        const container = document.getElementById("contentArea");

        const groupedTabs = {};
        branchesData.forEach((b) => {
          const key = `${normalizeTab(b.tabHeader1)}|${normalizeTab(
            b.tabHeader2
          )}`;
          if (!groupedTabs[key]) groupedTabs[key] = [];
          groupedTabs[key].push(b);
        });

        const branches = groupedTabs[currentTabId];
        if (!branches) return;

        const locationGroups = {};
        branches.forEach((b) => {
          const loc = b.location?.location || "OTHER LOCATION";

          if (!locationGroups[loc]) locationGroups[loc] = [];
          locationGroups[loc].push(b);
        });

        const locations = Object.keys(locationGroups);

        container.innerHTML = `
    <div class="flex gap-3 mb-4">
      ${locations
        .map(
          (l, i) => `
        <button onclick="switchSub(${i})"
          class="px-4 py-2 rounded-lg text-white ${
            i === currentSubIndex ? "bg-purple-700" : "bg-purple-400"
          }">
          ${l}
        </button>
      `
        )
        .join("")}
    </div>

    ${renderMergedBranch(locationGroups[locations[currentSubIndex]])}
  `;
      }

      function switchTab(id) {
        currentTabId = id;
        currentSubIndex = 0;
        renderMainTabs();
        renderContent();
      }

      function switchSub(i) {
        currentSubIndex = i;
        renderContent();
      }

      fetchBranches();
    </script>
  </body>
</html>

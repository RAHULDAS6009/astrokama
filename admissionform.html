<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student Admission Form</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Story+Script&family=TikTok+Sans:opsz,wght@12..36,300..900&family=Vend+Sans:ital,wght@0,300..700;1,300..700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

    <style>
      .lotus-title {
        background: linear-gradient(135deg, #8a1538, #f28c28, #e3c72f, #3ca66b);
        -webkit-background-clip: text;
        color: transparent;
      }

      @media print {
        .no-print {
          display: none !important;
        }

        body {
          background: white !important;
        }
      }

      .violet-gradient {
        background: linear-gradient(135deg, #f2f1ff 0%, #e9ffef 100%);
      }

      body {
        background: linear-gradient(135deg, #f2f1ff 0%, #e9ffef 100%);
      }

      .story-script-regular {
        font-family: "Story Script", sans-serif;
      }

      .vend-sans {
        font-family: "Vend Sans", sans-serif;
      }

      @media (max-width: 768px) {
        .header-title {
          font-size: 1.5rem !important;
        }

        .header-subtitle {
          font-size: 0.65rem !important;
        }

        .nav-menu {
          flex-direction: column !important;
          gap: 0.5rem !important;
        }

        .nav-menu li {
          width: 100%;
          text-align: center;
        }

        .file-grid {
          grid-template-columns: 1fr !important;
        }
      }

      .fee-banner {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-left: 4px solid #fbbf24;
      }
    </style>
  </head>

  <body class="bg-green-100">
    <header
      class="bg-[#523A35] border-b-4 border-[#D4A017] flex flex-col items-center px-4 md:px-6 py-4 shadow-md"
    >
      <div class="flex justify-center items-center space-x-2 md:space-x-4">
        <img
          src="academiclogo.png"
          alt="Logo"
          class="h-12 md:h-20 w-auto drop-shadow-md"
        />

        <div class="flex flex-col leading-tight text-center">
          <h1
            class="header-title text-2xl md:text-4xl font-extrabold text-[#f4d37d] tracking-wide drop-shadow"
          >
            MODERN ASTROLOGY
          </h1>

          <p
            class="header-subtitle text-white font-semibold text-xs md:text-sm tracking-wide"
          >
            KRISHNAMURTI ACADEMY OF MODERN ASTROLOGY & SPIRITUAL DEVELOPMENT
          </p>
        </div>
      </div>

      <p
        class="mt-3 text-white text-xs md:text-sm font-semibold tracking-wide text-center px-2 md:px-4"
      >
        Registered Under
        <span class="underline">Government of West Bengal</span> &
        <span class="underline">Government of India</span> ‚Ä¢ ISO Certified
        Institute ‚Ä¢
        <span class="text-yellow-300 font-bold"
          >Registration Number Provided After Course Completion</span
        >
        ‚Ä¢ Official Certificate Every Semester
      </p>
    </header>

    <nav class="w-full bg-[#FDECC2] py-3 md:py-4">
      <ul
        class="nav-menu flex justify-center space-x-4 md:space-x-16 font-bold text-purple-800 text-sm md:text-lg tracking-wide px-2"
      >
        <li><a href="#" class="hover:text-purple-600">HOME</a></li>
        <li>
          <a href="booking.html" class="hover:text-purple-600">CONSULTANCY</a>
        </li>
        <li>
          <a
            href="academic.html"
            class="bg-purple-800 text-white px-3 md:px-4 py-2 rounded-full shadow-lg hover:bg-purple-900"
          >
            ACADEMIC / COURSES
          </a>
        </li>

        <li>
          <a href="studentcorner.html" class="hover:text-purple-600"
            >STUDENT CORNER</a
          >
        </li>
        <li>
          <a href="contact.html" class="hover:text-purple-600">CONTACT</a>
        </li>
      </ul>
    </nav>

    <div
      class="max-w-3xl mx-auto bg-white shadow-xl p-4 md:p-8 my-6 md:my-10 rounded-xl mx-4"
    >
      <!-- Admission Fee Banner -->
      <div
        id="feeBanner"
        class="fee-banner text-white p-4 rounded-lg mb-6 hidden"
      >
        <div class="flex items-center justify-between">
          <div>
            <h3 class="font-bold text-lg">Admission Fee Required</h3>
            <p class="text-sm opacity-90" id="feeDetails">
              Select a course to see the admission fee
            </p>
          </div>
          <div class="text-right">
            <p class="text-2xl font-bold" id="feeAmount">‚Çπ0</p>
            <p class="text-xs opacity-80">One-time payment</p>
          </div>
        </div>
      </div>

      <form id="admissionForm" class="space-y-4 md:space-y-6">
        <h1
          class="w-full font-extrabold text-2xl md:text-4xl text-center rounded-md bg-violet-100 py-3 md:py-4 border border-2 border-violet-400"
        >
          Admission Form
        </h1>

        <!-- Name -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >1. Name of the Student <span class="text-red-500">*</span></label
          >
          <input
            id="name"
            type="text"
            class="w-full border px-3 py-2 rounded mt-1 text-sm md:text-base"
            required
            placeholder="Enter full name"
          />
        </div>

        <!-- Gender -->
        <div>
          <label class="font-semibold text-sm md:text-base">
            Gender <span class="text-red-500">*</span>
          </label>
          <select
            id="gender"
            class="w-full border px-3 py-2 rounded mt-1 text-sm md:text-base"
            required
          >
            <option value="">-- Select Gender --</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
            <option value="Other">Other</option>
          </select>
        </div>

        <!-- Guardian Name -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >2. Guardian Name <span class="text-red-500">*</span></label
          >
          <input
            id="guardianName"
            type="text"
            class="w-full border px-3 py-2 rounded mt-1 text-sm md:text-base"
            required
            placeholder="Enter guardian's name"
          />
        </div>

        <!-- Relation With Guardian -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >3. Relation With Guardian
            <span class="text-red-500">*</span></label
          >
          <select
            id="relation"
            class="w-full border px-3 py-2 rounded mt-1 text-sm md:text-base"
            required
          >
            <option value="">-- Select Relation --</option>
            <option value="Father">Father</option>
            <option value="Mother">Mother</option>
            <option value="Husband">Husband</option>
            <option value="Wife">Wife</option>
            <option value="Brother">Brother</option>
            <option value="Sister">Sister</option>
            <option value="Son">Son</option>
            <option value="Daughter">Daughter</option>
            <option value="Uncle">Uncle</option>
            <option value="Aunt">Aunt</option>
            <option value="Grandfather">Grandfather</option>
            <option value="Grandmother">Grandmother</option>
            <option value="Guardian">Legal Guardian</option>
            <option value="Other">Other</option>
          </select>
        </div>

        <!-- Other Relation -->
        <div id="otherRelationDiv" style="display: none">
          <label class="font-semibold text-sm md:text-base"
            >Specify Relation</label
          >
          <input
            id="otherRelation"
            type="text"
            class="w-full border px-3 py-2 rounded mt-1 text-sm md:text-base"
            placeholder="Please specify"
          />
        </div>

        <!-- Mode -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >Mode of Course <span class="text-red-500">*</span></label
          >
          <div
            class="flex flex-col md:flex-row items-start md:items-center gap-3 md:gap-6 mt-2"
          >
            <label class="flex items-center gap-2">
              <input
                type="radio"
                name="mode"
                value="Online"
                class="w-4 h-4"
                checked
              />
              <span class="text-sm md:text-base">Online</span>
            </label>
            <label class="flex items-center gap-2">
              <input type="radio" name="mode" value="Offline" class="w-4 h-4" />
              <span class="text-sm md:text-base">Offline</span>
            </label>
          </div>
        </div>

        <!-- Course -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >Course Details <span class="text-red-500">*</span></label
          >
          <select
            id="courseSelect"
            class="w-full border px-3 py-2 rounded mt-1 text-sm md:text-base"
            required
          >
            <option value="">-- Select Course --</option>
          </select>
        </div>

        <!-- Password -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >Password <span class="text-red-500">*</span></label
          >
          <div class="relative mt-1">
            <input
              id="passwordField"
              type="password"
              class="w-full border px-3 py-2 rounded text-sm md:text-base"
              required
              placeholder="Create a password"
              minlength="6"
            />
            <button
              type="button"
              onclick="togglePassword()"
              class="absolute right-3 md:right-4 top-1/2 -translate-y-1/2 text-gray-600 text-lg md:text-xl"
            >
              üëÅÔ∏è
            </button>
          </div>
          <p class="text-xs text-gray-500 mt-1">Minimum 6 characters</p>
        </div>

        <!-- Addresses -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >Communication Address <span class="text-red-500">*</span></label
          >
          <textarea
            id="commAddress"
            rows="2"
            class="w-full border px-3 py-2 rounded text-sm md:text-base"
            required
            placeholder="Enter your current address"
          ></textarea>
        </div>

        <div>
          <label class="font-semibold text-sm md:text-base"
            >Permanent Address <span class="text-red-500">*</span></label
          >
          <textarea
            id="permAddress"
            rows="2"
            class="w-full border px-3 py-2 rounded text-sm md:text-base"
            required
            placeholder="Enter your permanent address"
          ></textarea>
          <label class="flex items-center gap-2 mt-2">
            <input type="checkbox" id="sameAddress" class="w-4 h-4" />
            <span class="text-xs md:text-sm"
              >Same as communication address</span
            >
          </label>
        </div>

        <!-- Email -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >Email Address <span class="text-red-500">*</span></label
          >
          <input
            id="email"
            type="email"
            class="w-full border px-3 py-2 rounded text-sm md:text-base"
            required
            placeholder="example@email.com"
          />
        </div>

        <!-- Mobile & WhatsApp -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
          <div>
            <label class="font-semibold text-sm md:text-base"
              >Mobile Number <span class="text-red-500">*</span></label
            >
            <input
              id="phone"
              type="tel"
              class="w-full border px-3 py-2 rounded text-sm md:text-base"
              required
              placeholder="10-digit mobile number"
              pattern="[0-9]{10}"
              maxlength="10"
            />
          </div>

          <div>
            <label class="font-semibold text-sm md:text-base"
              >WhatsApp Number <span class="text-red-500">*</span></label
            >
            <input
              id="whatsapp"
              type="tel"
              class="w-full border px-3 py-2 rounded text-sm md:text-base"
              required
              placeholder="10-digit WhatsApp number"
              pattern="[0-9]{10}"
              maxlength="10"
            />
            <label class="flex items-center gap-2 mt-2">
              <input type="checkbox" id="samePhone" class="w-4 h-4" />
              <span class="text-xs md:text-sm">Same as mobile number</span>
            </label>
          </div>
        </div>

        <!-- DOB -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >Date, Time & Place of Birth
            <span class="text-red-500">*</span></label
          >
          <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mt-1">
            <input
              id="dob"
              type="date"
              class="border px-3 py-2 rounded text-sm md:text-base"
              required
            />
            <input
              id="birthTime"
              type="time"
              class="border px-3 py-2 rounded text-sm md:text-base"
              required
            />
            <input
              id="birthPlace"
              type="text"
              class="border px-3 py-2 rounded text-sm md:text-base"
              placeholder="Place of Birth"
              required
            />
          </div>
        </div>

        <!-- Qualification -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >Educational Qualification
            <span class="text-red-500">*</span></label
          >
          <input
            id="qualification"
            type="text"
            class="w-full border px-3 py-2 rounded text-sm md:text-base"
            required
            placeholder="e.g., B.A., B.Sc., 12th Pass, etc."
          />
        </div>

        <!-- Extra Experience -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >Extra Experience</label
          >
          <input
            id="experience"
            type="text"
            class="w-full border px-3 py-2 rounded text-sm md:text-base"
            placeholder="Any additional experience or skills"
          />
        </div>

        <!-- Astro Experience -->
        <div>
          <label class="font-semibold text-sm md:text-base"
            >Astrological Experience (If Any)</label
          >
          <input
            id="astroExp"
            type="text"
            class="w-full border px-3 py-2 rounded text-sm md:text-base"
            placeholder="Previous knowledge in astrology"
          />
        </div>

        <!-- Occupation -->
        <div>
          <label class="font-semibold text-sm md:text-base">Occupation</label>
          <input
            id="occupation"
            type="text"
            class="w-full border px-3 py-2 rounded text-sm md:text-base"
            placeholder="Your current occupation"
          />
        </div>

        <!-- Files -->
        <div class="file-grid grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
          <div>
            <label class="font-semibold text-sm md:text-base"
              >Upload Photo</label
            >
            <input
              id="photo"
              type="file"
              accept="image/*"
              class="w-full border p-2 rounded text-xs md:text-sm"
            />
            <p class="text-xs text-gray-500 mt-1">Max 2MB</p>
          </div>

          <div>
            <label class="font-semibold text-sm md:text-base"
              >Upload Certificate</label
            >
            <input
              id="certificate"
              type="file"
              accept=".pdf,image/*"
              class="w-full border p-2 rounded text-xs md:text-sm"
            />
            <p class="text-xs text-gray-500 mt-1">PDF or Image</p>
          </div>

          <div>
            <label class="font-semibold text-sm md:text-base"
              >Upload ID Proof</label
            >
            <input
              id="idproof"
              type="file"
              accept=".pdf,image/*"
              class="w-full border p-2 rounded text-xs md:text-sm"
            />
            <p class="text-xs text-gray-500 mt-1">Aadhaar/PAN/Passport</p>
          </div>
        </div>

        <!-- Submit -->
        <div class="text-center mt-6 md:mt-8">
          <button
            id="submitBtn"
            type="submit"
            class="bg-violet-500 text-white px-8 md:px-10 py-3 rounded-lg shadow-lg hover:bg-violet-700 w-full md:w-auto text-sm md:text-base font-semibold"
          >
            Proceed to Pay Admission Fee
          </button>
        </div>
      </form>
      <!-- Student ID Box (Hidden by Default) -->
      <div
        id="studentIdBox"
        class="hidden mt-10 p-6 bg-green-50 border border-green-400 rounded-lg shadow-lg text-center"
      >
        <h2 class="text-xl md:text-2xl font-bold text-green-800">
          üéâ Admission Successful!
        </h2>

        <p class="mt-3 text-lg font-semibold text-green-700">
          Your Student ID:
        </p>

        <p
          id="generatedStudentId"
          class="text-3xl font-extrabold text-green-900 mt-1 tracking-wide"
        ></p>

        <p class="mt-4 text-red-600 font-semibold text-sm md:text-base">
          ‚ö† Please take a screenshot of your Student ID ‚Äî you will need it for
          login.
        </p>

        <button
          onclick="goToDashboard()"
          class="mt-6 bg-purple-700 text-white px-6 py-3 rounded-lg font-bold shadow hover:bg-purple-900"
        >
          Go to Student Dashboard
        </button>
      </div>
    </div>

    <script>
      function goToDashboard() {
        window.location.href = "studentcorner.html"; // change link if needed
      }

      let selectedCourseData = null;
      let razorpayKey = "rzp_test_RnVTdYtOyolkhI"; // Replace with your Razorpay key

      // Toggle password visibility
      function togglePassword() {
        const input = document.getElementById("passwordField");
        input.type = input.type === "password" ? "text" : "password";
      }

      // Show/hide other relation input
      document
        .getElementById("relation")
        .addEventListener("change", function () {
          const otherDiv = document.getElementById("otherRelationDiv");
          const otherInput = document.getElementById("otherRelation");

          if (this.value === "Other") {
            otherDiv.style.display = "block";
            otherInput.required = true;
          } else {
            otherDiv.style.display = "none";
            otherInput.required = false;
            otherInput.value = "";
          }
        });

      // Same address checkbox
      document
        .getElementById("sameAddress")
        .addEventListener("change", function () {
          if (this.checked) {
            document.getElementById("permAddress").value =
              document.getElementById("commAddress").value;
          }
        });

      // Same phone checkbox
      document
        .getElementById("samePhone")
        .addEventListener("change", function () {
          if (this.checked) {
            document.getElementById("whatsapp").value =
              document.getElementById("phone").value;
          }
        });

      // Load courses with admission fee info
      async function loadCourses() {
        try {
          const res = await fetch("https://api.rahuldev.live/allcourse");
          const data = await res.json();

          if (!data.success) {
            console.error("Failed to load courses", data);
            return;
          }

          const select = document.getElementById("courseSelect");
          select.innerHTML = `<option value="">-- Select Course --</option>`;

          data.data.forEach((course) => {
            (course.branches || []).forEach((branch) => {
              const firstSemester =
                branch.semsters && branch.semsters.length > 0
                  ? branch.semsters[0]
                  : null;

              const payload = {
                courseId: course.id,
                branchId: branch.id,
                courseName: course.name || "",
                courseType: course.courseType || course.type || "",
                branchName: branch.name || "",
                admissionFee: firstSemester?.admissionFee || 0,
                semesterId: firstSemester?.id || null,
                semesterName: firstSemester?.name || "",
              };

              const opt = document.createElement("option");
              opt.value = JSON.stringify(payload);
              opt.textContent = `${payload.courseType} - ${payload.branchName}`;
              select.appendChild(opt);
            });
          });
        } catch (err) {
          console.error("Error loading courses", err);
          alert("Failed to load courses. Please refresh the page.");
        }
      }

      // Update fee banner when course is selected
      document
        .getElementById("courseSelect")
        .addEventListener("change", function () {
          const selectedValue = this.value;

          if (!selectedValue) {
            document.getElementById("feeBanner").classList.add("hidden");
            selectedCourseData = null;
            return;
          }

          selectedCourseData = JSON.parse(selectedValue);

          if (selectedCourseData.admissionFee > 0) {
            document.getElementById("feeBanner").classList.remove("hidden");
            document.getElementById(
              "feeAmount"
            ).textContent = `‚Çπ${selectedCourseData.admissionFee}`;
            document.getElementById("feeDetails").textContent = `${
              selectedCourseData.semesterName || "First Semester"
            } - Admission Fee (One-time)`;
          } else {
            document.getElementById("feeBanner").classList.add("hidden");
            alert(
              "Admission fee not set for this course. Please contact admin."
            );
          }
        });

      loadCourses();

      // Upload file
      // Upload file with size restrictions
      async function uploadFile(file) {
        if (!file) return null;

        const isPDF = file.type === "application/pdf";

        // Set max sizes
        const maxSize = isPDF ? 5 * 1024 * 1024 : 2 * 1024 * 1024;

        if (file.size > maxSize) {
          alert(
            `‚ùå ${file.name} is too large.\n\nPDF limit: 5MB\nImages limit: 2MB`
          );
          return "FILE_TOO_LARGE"; // Prevent API call later
        }

        const fd = new FormData();
        fd.append("file", file);

        try {
          const res = await fetch("https://api.rahuldev.live/upload-file", {
            method: "POST",
            body: fd,
          });

          const json = await res.json();
          if (json && json.success && json.url) return json.url;

          return null;
        } catch (err) {
          console.error("Upload error", err);
          return null;
        }
      }

      // Initialize Razorpay payment
      function initializeRazorpay(formData, fileUrls) {
        const options = {
          key: razorpayKey,
          amount: selectedCourseData.admissionFee * 100, // Amount in paise
          currency: "INR",
          name: "Modern Astrology Academy",
          description: `Admission Fee - ${selectedCourseData.semesterName}`,
          image: "academiclogo.png",
          handler: function (response) {
            // Payment successful
            submitAdmission(formData, fileUrls, {
              razorpayPaymentId: response.razorpay_payment_id,
              razorpayOrderId: response.razorpay_order_id,
              razorpaySignature: response.razorpay_signature,
            });
          },
          prefill: {
            name: formData.name,
            email: formData.email,
            contact: formData.mobileNumber,
          },
          theme: {
            color: "#8B5CF6",
          },
          modal: {
            ondismiss: function () {
              const submitBtn = document.getElementById("submitBtn");
              submitBtn.disabled = false;
              submitBtn.textContent = "Proceed to Pay Admission Fee";
              alert("Payment cancelled. Please try again.");
            },
          },
        };

        const rzp = new Razorpay(options);
        rzp.open();
      }

      // Submit admission after successful payment
      async function submitAdmission(formData, fileUrls, paymentDetails) {
        event?.preventDefault();

        const submitBtn = document.getElementById("submitBtn");
        submitBtn.textContent = "Creating admission...";

        try {
          const payload = {
            ...formData,
            ...fileUrls,
            ...paymentDetails,
          };

          const admissionRes = await fetch(
            "https://api.rahuldev.live/api/v1/admission",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload),
            }
          );

          const admissionJson = await admissionRes.json();

          if (admissionJson && admissionJson.success) {
            const studentIdBox = document.getElementById("studentIdBox");
            const generatedId = document.getElementById("generatedStudentId");

            // Show student ID box
            studentIdBox.classList.remove("hidden");

            // Fill student ID
            generatedId.textContent =
              admissionJson.data?.student?.studentId || "N/A";

            // Scroll to view
            studentIdBox.scrollIntoView({ behavior: "smooth" });

            // Reset submit button
            submitBtn.disabled = false;
            submitBtn.textContent = "Payment Completed";
            submitBtn.classList.add("bg-green-600", "text-white");

            location.reload();
          } else {
            alert(
              "‚ùå Admission failed: " +
                (admissionJson.message || "Unknown error")
            );
          }
        } catch (err) {
          console.error("Submit error:", err);
          alert("Something went wrong: " + err.message);
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = "Proceed to Pay Admission Fee";
        }
      }

      // Form submission handler
      document
        .getElementById("admissionForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const submitBtn = document.getElementById("submitBtn");
          submitBtn.disabled = true;
          submitBtn.textContent = "Processing...";

          try {
            // Validate course selection
            if (!selectedCourseData) {
              alert("Please select a course.");
              submitBtn.disabled = false;
              submitBtn.textContent = "Proceed to Pay Admission Fee";
              return;
            }

            if (
              !selectedCourseData.admissionFee ||
              selectedCourseData.admissionFee <= 0
            ) {
              alert(
                "Admission fee not set for this course. Please contact administrator."
              );
              submitBtn.disabled = false;
              submitBtn.textContent = "Proceed to Pay Admission Fee";
              return;
            }

            // Upload files first
            submitBtn.textContent = "Uploading files...";

            const photoFile = document.getElementById("photo").files[0];
            const certificateFile =
              document.getElementById("certificate").files[0];
            const idProofFile = document.getElementById("idproof").files[0];

            const fileUrls = {
              photoUrl: photoFile ? await uploadFile(photoFile) : null,
              certificateUrl: certificateFile
                ? await uploadFile(certificateFile)
                : null,
              idProofUrl: idProofFile ? await uploadFile(idProofFile) : null,
            };
            // ‚ùå Stop if any PDF exceeded size limit
            if (
              fileUrls.photoUrl === "FILE_TOO_LARGE" ||
              fileUrls.certificateUrl === "FILE_TOO_LARGE" ||
              fileUrls.idProofUrl === "FILE_TOO_LARGE"
            ) {
              alert("‚ùå File too large. Fix the file size before submitting.");
              submitBtn.disabled = false;
              submitBtn.textContent = "Proceed to Pay Admission Fee";
              return; // ‚õî Do NOT continue ‚Üí No backend call, no payment
            }

            // Get relation value
            let relationValue = document.getElementById("relation").value;
            if (relationValue === "Other") {
              relationValue = document
                .getElementById("otherRelation")
                .value.trim();
            }

            // Build form data
            const formData = {
              name: document.getElementById("name").value.trim(),
              email: document.getElementById("email").value.trim(),
              password: document.getElementById("passwordField").value,
              courseId: parseInt(selectedCourseData.courseId, 10),
              branchId: selectedCourseData.branchId,
              courseDetails: `${selectedCourseData.courseType} - ${selectedCourseData.branchName}`,
              courseMode:
                document.querySelector("input[name='mode']:checked")?.value ||
                "Online",
              gurdianName: document.getElementById("guardianName").value.trim(),
              gender: document.getElementById("gender").value,
              relationWithGurdain: relationValue,
              communicationAddress: document
                .getElementById("commAddress")
                .value.trim(),
              permanentAddress: document
                .getElementById("permAddress")
                .value.trim(),
              mobileNumber: document.getElementById("phone").value.trim(),
              whatsappNumber: document.getElementById("whatsapp").value.trim(),
              dateOfBirth: document.getElementById("dob").value,
              placeOfBirth: document.getElementById("birthPlace").value.trim(),
              educationalQualification: document
                .getElementById("qualification")
                .value.trim(),
              extraExperience:
                document.getElementById("experience").value.trim() || null,
              astrologicalExperience:
                document.getElementById("astroExp").value.trim() || null,
              occupation:
                document.getElementById("occupation").value.trim() || null,
            };

            // Initialize Razorpay payment
            submitBtn.textContent = "Opening payment gateway...";
            initializeRazorpay(formData, fileUrls);
          } catch (err) {
            console.error("Form submission error:", err);
            alert("Something went wrong: " + err.message);
            submitBtn.disabled = false;
            submitBtn.textContent = "Proceed to Pay Admission Fee";
          }
        });
    </script>
  </body>
</html>
